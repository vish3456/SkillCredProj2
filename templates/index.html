<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Analyzer Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 p-8">
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-8">
        <h1 class="text-4xl font-bold text-center mb-6 text-gray-900">üóûÔ∏è News Analyzer Pro</h1>

        <div class="space-y-6">
            <div>
                <h2 class="text-2xl font-semibold mb-4">Analyze a Single Article</h2>
                <input type="text" id="urlInput" placeholder="Paste article URL here..." class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300">
                <p class="text-center my-4 text-gray-600">OR</p>
                <textarea id="textInput" rows="8" placeholder="Paste article text here..." class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300"></textarea>

                <h3 class="text-xl font-medium mt-4 mb-2">Choose your tone:</h3>
                <div class="flex flex-wrap gap-4">
                    <button onclick="process('neutral summary')" class="px-6 py-3 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition duration-300">Neutral Summary</button>
                    <button onclick="process('fact-only')" class="px-6 py-3 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition duration-300">Fact-Only</button>
                    <button onclick="process('explain to a 10-year-old')" class="px-6 py-3 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition duration-300">Explain to a 10-Year-Old</button>
                </div>
            </div>

            <div>
                <h2 class="text-2xl font-semibold mt-8 mb-4">Compare Multiple Sources</h2>
                <div class="flex gap-4">
                    <input type="text" id="queryInput" placeholder="Enter a topic (e.g., 'climate change')" class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300">
                    <button onclick="compareSources()" class="px-6 py-3 bg-green-500 text-white rounded-lg font-bold hover:bg-green-600 transition duration-300">Compare</button>
                </div>
                <div id="comparisonLoading" class="hidden text-center mt-4">
                    <div class="loading-spinner"></div>
                    <p>Fetching and analyzing sources...</p>
                </div>
            </div>
        </div>

        <div id="resultsContainer" class="mt-8">
            <div id="loadingIndicator" class="hidden text-center mt-4">
                <div class="loading-spinner"></div>
                <p>Analyzing... please wait</p>
            </div>

            <div id="singleArticleResults" class="p-6 border border-gray-200 rounded-lg hidden">
                <h3 class="text-xl font-bold mb-2">Summary:</h3>
                <p id="summaryOutput" class="mb-4 text-gray-700"></p>
                <h3 class="text-xl font-bold mb-2">Bias Detection:</h3>
                <p id="biasOutput" class="text-gray-700"></p>
            </div>

            <div id="comparisonResults" class="p-6 border border-gray-200 rounded-lg hidden">
                <h3 class="text-xl font-bold mb-2">Sentiment Comparison:</h3>
                <canvas id="biasChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        async function process(tone) {
            const url = document.getElementById('urlInput').value;
            const text = document.getElementById('textInput').value;
            const loadingDiv = document.getElementById('loadingIndicator');
            const singleArticleResultsDiv = document.getElementById('singleArticleResults');

            singleArticleResultsDiv.classList.add('hidden');
            loadingDiv.classList.remove('hidden');

            try {
                const response = await fetch('/process', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: url, text: text, tone: tone })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Something went wrong.');
                }

                const data = await response.json();

                document.getElementById('summaryOutput').textContent = data.summary;
                document.getElementById('biasOutput').textContent = data.bias_flag;

                singleArticleResultsDiv.classList.remove('hidden');
            } catch (error) {
                alert(`Error: ${error.message}`);
            } finally {
                loadingDiv.classList.add('hidden');
            }
        }

        let myChart; // To store the chart instance
        async function compareSources() {
            const query = document.getElementById('queryInput').value;
            const loadingDiv = document.getElementById('comparisonLoading');
            const comparisonResultsDiv = document.getElementById('comparisonResults');

            if (!query) {
                alert("Please enter a topic to compare.");
                return;
            }

            comparisonResultsDiv.classList.add('hidden');
            loadingDiv.classList.remove('hidden');

            try {
                const response = await fetch('/compare', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: query })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Something went wrong.');
                }

                const data = await response.json();

                if (myChart) {
                    myChart.destroy();
                }

                const sources = data.results.map(res => res.source);
                const scores = data.results.map(res => res.score);
                const sentiments = data.results.map(res => res.sentiment);
                const backgroundColors = sentiments.map(sentiment => {
                    if (sentiment === "POSITIVE") return 'rgba(75, 192, 192, 0.6)';
                    if (sentiment === "NEGATIVE") return 'rgba(255, 99, 132, 0.6)';
                    return 'rgba(201, 203, 207, 0.6)';
                });

                const ctx = document.getElementById('biasChart').getContext('2d');
                myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: sources,
                        datasets: [{
                            label: 'Sentiment Score',
                            data: scores,
                            backgroundColor: backgroundColors,
                            borderColor: backgroundColors.map(color => color.replace('0.6', '1')),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 1.0,
                                title: {
                                    display: true,
                                    text: 'Sentiment Score'
                                }
                            }
                        }
                    }
                });

                comparisonResultsDiv.classList.remove('hidden');
            } catch (error) {
                alert(`Error: ${error.message}`);
            } finally {
                loadingDiv.classList.add('hidden');
            }
        }
    </script>
</body>
</html>